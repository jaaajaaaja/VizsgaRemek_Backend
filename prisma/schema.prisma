// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int                      @id @default(autoincrement())
  userName         String
  email            String                   @unique
  password         String
  age              Int?
  role             String                   @default("user")
  comments         Comment[]
  photos           Photo[]
  userInterests    User_Interest[]
  news             News[]
  requestSent      User_Friend[]            @relation("requestSent")
  requestRecieved  User_Friend[]            @relation("requestRecieved")
  sentRequests     Pending_Friend_Request[] @relation("sentRequests")
  receivedRequests Pending_Friend_Request[] @relation("receivedRequests")
}

model User_Interest {
  id       Int    @id @default(autoincrement())
  interest String
  userID   Int
  user     User   @relation(fields: [userID], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([userID, interest])
}

model User_Friend {
  id       Int  @id @default(autoincrement())
  userID   Int
  friendID Int
  user     User @relation("requestSent", fields: [userID], references: [id], onDelete: Cascade)
  friend   User @relation("requestRecieved", fields: [friendID], references: [id], onDelete: Cascade)

  @@unique([userID, friendID])
}

model Pending_Friend_Request {
  id       Int  @id @default(autoincrement())
  userID   Int
  friendID Int
  user     User @relation("sentRequests", fields: [userID], references: [id], onDelete: Cascade)
  friend   User @relation("receivedRequests", fields: [friendID], references: [id], onDelete: Cascade)

  @@unique([userID, friendID])
}

model Place {
  id              Int              @id @default(autoincrement())
  googleplaceID   String           @unique
  name            String
  address         String
  comments        Comment[]
  photos          Photo[]
  placeCategories Place_Category[]
  news            News[]
}

model Place_Category {
  id       Int    @id @default(autoincrement())
  category String
  placeID  Int
  place    Place  @relation(fields: [placeID], references: [id], onDelete: Cascade)

  @@unique([category, placeID])
}

model Comment {
  id          Int      @id @default(autoincrement())
  commentText String
  rating      Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userID      Int
  placeID     Int
  approved    Boolean  @default(false)
  user        User     @relation(fields: [userID], references: [id], onDelete: Cascade, onUpdate: Cascade)
  place       Place    @relation(fields: [placeID], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Photo {
  id       Int     @id @default(autoincrement())
  location String
  type     String
  userID   Int
  placeID  Int
  approved Boolean @default(false)
  user     User    @relation(fields: [userID], references: [id], onDelete: Cascade, onUpdate: Cascade)
  place    Place   @relation(fields: [placeID], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model News {
  id        Int      @id @default(autoincrement())
  text      String   @db.LongText
  placeID   Int
  userID    Int
  approved  Boolean  @default(false)
  createdAt DateTime @default(now())
  place     Place    @relation(fields: [placeID], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userID], references: [id], onDelete: Cascade)
}
